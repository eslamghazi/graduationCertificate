Sub MatchPhotos()
    Dim ws As Worksheet
    Dim studentName As String
    Dim folderPath As String
    Dim photoPath As String
    Dim i As Long
    Dim fileName As String
    Dim splittedFileName As String
    Dim fso As Object
    Dim file As Object
    Dim firstThreeNames As String
    Dim pathNum As Integer

    

    ' Set the worksheet
    Set ws = ThisWorkbook.Sheets(2) ' Adjust the sheet index or name as necessary

    ' Set the folder path
    folderPath = ThisWorkbook.Path & "\"

    ' Create FileSystemObject
    Set fso = CreateObject("Scripting.FileSystemObject")

    ' Loop through the student names in Column C
    For i = 1 To ws.Cells(ws.Rows.Count, "B").End(xlUp).Row
        studentName = ws.Cells(i, 2).Value
        studentName = Replace(studentName, "ى", "ي")
        studentName = Replace(studentName, "ه", "ة")
        ' Get the first 8 letters of the student name
        If InStr(studentName, " ") > 3 Then

            firstThreeNames = Split(studentName, " ")(0) & Split(studentName, " ")(1) & Split(studentName, " ")(2)
        Else
            firstThreeNames = studentName
        End If

        ' Loop through the files in the folder
        For Each file In fso.GetFolder(folderPath).Files
            fileName = file.Name
            splittedFileName = Replace(fileName, "ى", "ي")
            splittedFileName = Replace(fileName, "ه", "ة")
            If InStr(fileName, " ") > 3 Then
splittedFileName = Split(splittedFileName, " ")(0) & Split(splittedFileName, " ")(1) & Split(splittedFileName, " ")(2)
Else
splittedFileName = fileName
End If
            ' Check if the file name contains the first 8 letters of the student name
            If InStr(1, splittedFileName, firstThreeNames, vbTextCompare) > 0 Then
                photoPath = folderPath & fileName

                If (IsEmpty(ws.Cells(i, 3).Value)) Then
                ws.Cells(i, 3).Value = photoPath
                pathNum = pathNum + 1
                 End If
                Exit For
            End If
        Next file
    Next i

    ' Clean up
    Set fso = Nothing
    MsgBox "There are " & pathNum & " element(s)."
End Sub
